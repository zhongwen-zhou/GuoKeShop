<%= flash[:notice] if flash[:notice] %>

<ul>
  <% Category.all.each do |category| %>
    <li><%= link_to category.name, items_path(category_id: category) %></li>
  <% end %>
</ul>

<table class="table table-bordered table-hover">
  <thead>
    <tr>
      <th>编号</th>
      <th>商品名</th>
      <th>厂家</th>
      <th>定价</th>
      <th>仓库余量</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody>
  <%= @items.each_with_index do |item, index| %>
    <tr>
      <td><%= index %></td>
      <td><%= item.name %></td>
      <td><%= item.brand %></td>
      <td><%= item.price %></td>
      <td><%= item.repo_count %></td>
      <td>
        <%= form_tag(add_cut_item_path(item)) do |f| %>
          <label>数量</label>
          <input type="text" name="count"></input>
          <input type="hidden" name="price" value="<%= item.price %>"></input>
          <input type="submit" value="加入购物车"></input>
        <% end %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>
<hr/>
<h3>购物车(<%= session[:cut].size %> 件商品)</h3>
<%= link_to '清空购物车', clear_cut_items_path, method: :delete, data: { confirm: "你确定要清空购物车么?" } %>
<table class="table table-bordered table-hover">
  <thead>
    <tr>
      <th>
        商品名
      </th>
      <th>
        单价
      </th>
      <th>
        数量
      </th>
      <th>
        总价
      </th>
    </tr>
  </thead>
  <tbody>
    <% total_price = 0 %>
    <% session[:cut].each do |item| %>
      <tr>
        <td><%= Item.find(item['item_id']).name %></td>
        <td><%= item['price'] %></td>
        <td><%= item['count'] %></td>
        <td><%= item_price = item['count'].to_i * item['price'].to_f %></td>
        <% total_price += item_price %>
      </tr>
    <% end %>
    <tr>
      总计：<%= total_price %>
    </tr>
  </tbody>
</table>
<%= form_tag(orders_path) do |f| %>
  <label>门牌号:</label>
  <input type="text" name="address"></input>
  <label>联系电话:</label>
  <input type="text" name="telphone"></input>
  <input type="hidden" name="total_price" value="<%= total_price %>"></input>
  <input type="submit" value="提交订单"></input>
<% end %>
